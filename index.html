<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™å‘åª’åˆå¹³å° - å°ˆæ¥­ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .balance {
            background: #f0f4ff;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .balance:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #48bb78;
            color: white;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-logout {
            background: #e2e8f0;
            color: #2d3748;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #2d3748;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #4a5568;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .form-actions button {
            flex: 1;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #e2e8f0;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            color: #718096;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }

        .card-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-job {
            background: #bee3f8;
            color: #2c5282;
        }

        .badge-talent {
            background: #c6f6d5;
            color: #22543d;
        }

        .card-author {
            color: #718096;
            font-size: 14px;
            margin-top: 5px;
        }

        .card-category {
            display: inline-block;
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 13px;
            margin-top: 10px;
        }

        .card-content {
            color: #4a5568;
            line-height: 1.6;
            margin: 15px 0;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .replies-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e2e8f0;
        }

        .reply-item {
            background: white;
            padding: 15px;
            border-left: 3px solid #667eea;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .reply-author {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .hidden-replies {
            background: #fff9e6;
            border: 2px dashed #ffa940;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
        }

        .hidden-replies h3 {
            color: #d46b08;
            margin-bottom: 15px;
        }

        .info-notice {
            background: #e6f7ff;
            border: 2px solid #1890ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }

        .payment-notice {
            background: #fff5f5;
            border: 2px solid #fc8181;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }

        .recharge-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .recharge-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .recharge-card:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.05);
        }

        .recharge-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .recharge-amount {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .recharge-bonus {
            background: #48bb78;
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 12px;
            margin-top: 8px;
            display: inline-block;
        }

        .payment-methods {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .payment-method {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .payment-method:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .payment-method.selected {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .payment-icon {
            font-size: 40px;
        }

        .payment-info {
            flex: 1;
            text-align: left;
        }

        .payment-name {
            font-weight: bold;
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .payment-desc {
            color: #718096;
            font-size: 14px;
        }

        .guest-notice {
            background: #fef5e7;
            border: 2px solid #f39c12;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            color: #d68910;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            .recharge-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™»å…¥/è¨»å†Š Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ¯ é›™å‘åª’åˆå¹³å°</h2>
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchAuthTab('login')">ç™»å…¥</button>
                    <button class="tab-btn" onclick="switchAuthTab('register')">è¨»å†Š</button>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label>å¸³è™Ÿ</label>
                        <input type="text" id="loginUsername" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç¢¼</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å…¥</button>
                    <button type="button" class="btn btn-logout" style="width: 100%; margin-top: 10px;" onclick="closeLoginModal()">å–æ¶ˆ</button>
                </form>

                <form id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label>å¸³è™Ÿ</label>
                        <input type="text" id="registerUsername" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç¢¼</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <div class="form-group">
                        <label>ç¢ºèªå¯†ç¢¼</label>
                        <input type="password" id="registerPasswordConfirm" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">è¨»å†Š (é€ NT$ 500)</button>
                    <button type="button" class="btn btn-logout" style="width: 100%; margin-top: 10px;" onclick="closeLoginModal()">å–æ¶ˆ</button>
                </form>
            </div>
        </div>

        <!-- å„²å€¼ Modal -->
        <div id="rechargeModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ’° å„²å€¼ä¸­å¿ƒ</h2>
                
                <div class="recharge-options">
                    <div class="recharge-card" onclick="selectRecharge(500)">
                        <div class="recharge-amount">$500</div>
                        <div style="color: #718096;">åŸºç¤æ–¹æ¡ˆ</div>
                    </div>
                    <div class="recharge-card" onclick="selectRecharge(1000)">
                        <div class="recharge-amount">$1000</div>
                        <div style="color: #718096;">ç†±é–€æ–¹æ¡ˆ</div>
                        <div class="recharge-bonus">é€ $100</div>
                    </div>
                    <div class="recharge-card" onclick="selectRecharge(2000)">
                        <div class="recharge-amount">$2000</div>
                        <div style="color: #718096;">è¶…å€¼æ–¹æ¡ˆ</div>
                        <div class="recharge-bonus">é€ $300</div>
                    </div>
                    <div class="recharge-card" onclick="selectRecharge(5000)">
                        <div class="recharge-amount">$5000</div>
                        <div style="color: #718096;">å°Šæ¦®æ–¹æ¡ˆ</div>
                        <div class="recharge-bonus">é€ $1000</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>è‡ªè¨‚é‡‘é¡ (æœ€ä½ NT$ 100)</label>
                    <input type="number" id="customAmount" placeholder="è¼¸å…¥è‡ªè¨‚é‡‘é¡" min="100">
                </div>

                <h3 style="margin: 20px 0 15px 0; color: #2d3748;">é¸æ“‡ä»˜æ¬¾æ–¹å¼</h3>
                <div class="payment-methods">
                    <div class="payment-method" onclick="selectPaymentMethod('ecpay')">
                        <div class="payment-icon">ğŸ’³</div>
                        <div class="payment-info">
                            <div class="payment-name">ç¶ ç•Œ ECPay</div>
                            <div class="payment-desc">ä¿¡ç”¨å¡ã€ATMã€è¶…å•†ä»£ç¢¼</div>
                        </div>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('newebpay')">
                        <div class="payment-icon">ğŸª</div>
                        <div class="payment-info">
                            <div class="payment-name">è—æ–° NewebPay</div>
                            <div class="payment-desc">ä¿¡ç”¨å¡ã€WebATMã€è¶…å•†</div>
                        </div>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('linepay')">
                        <div class="payment-icon">ğŸ’š</div>
                        <div class="payment-info">
                            <div class="payment-name">LINE Pay</div>
                            <div class="payment-desc">LINE Pay ä»˜æ¬¾</div>
                        </div>
                    </div>
                    <div class="payment-method" onclick="selectPaymentMethod('jkopay')">
                        <div class="payment-icon">ğŸ…¹</div>
                        <div class="payment-info">
                            <div class="payment-name">è¡—å£æ”¯ä»˜</div>
                            <div class="payment-desc">è¡—å£å¸³æˆ¶ä»˜æ¬¾</div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-logout" onclick="closeRechargeModal()">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-secondary" onclick="confirmRecharge()">ç¢ºèªä»˜æ¬¾</button>
                </div>
            </div>
        </div>

        <!-- ç™¼å¸ƒ Modal -->
        <div id="postModal" class="modal">
            <div class="modal-content">
                <h2 id="postModalTitle">ç™¼å¸ƒå…§å®¹</h2>
                <form id="postForm">
                    <div class="form-group">
                        <label>é¡å‹</label>
                        <select id="postType" required>
                            <option value="job">ğŸ¢ æˆ‘è¦æ‰¾äººæ‰ï¼ˆç™¼å¸ƒå·¥ä½œï¼‰</option>
                            <option value="talent">ğŸ‘” æˆ‘è¦æ‰¾å·¥ä½œï¼ˆå°ˆæ¥­äººæ‰ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>é ˜åŸŸåˆ†é¡</label>
                        <select id="postCategory" required>
                            <option value="">è«‹é¸æ“‡é ˜åŸŸ</option>
                            <option value="ç¨‹å¼é–‹ç™¼">ğŸ’» ç¨‹å¼é–‹ç™¼</option>
                            <option value="è¨­è¨ˆç¾è¡“">ğŸ¨ è¨­è¨ˆç¾è¡“</option>
                            <option value="è¡ŒéŠ·ä¼åŠƒ">ğŸ“Š è¡ŒéŠ·ä¼åŠƒ</option>
                            <option value="æ–‡å­—ç·¨è¼¯">âœï¸ æ–‡å­—ç·¨è¼¯</option>
                            <option value="å½±éŸ³è£½ä½œ">ğŸ¬ å½±éŸ³è£½ä½œ</option>
                            <option value="ç¿»è­¯èªè¨€">ğŸŒ ç¿»è­¯èªè¨€</option>
                            <option value="é¡§å•è«®è©¢">ğŸ’¼ é¡§å•è«®è©¢</option>
                            <option value="å…¶ä»–">ğŸ“Œ å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ¨™é¡Œ</label>
                        <input type="text" id="postTitle" required placeholder="ä¾‹ï¼šå°‹æ‰¾è³‡æ·±å‰ç«¯å·¥ç¨‹å¸«">
                    </div>
                    <div class="form-group">
                        <label>è©³ç´°å…§å®¹</label>
                        <textarea id="postContent" required placeholder="è©³ç´°æè¿°æ‚¨çš„éœ€æ±‚æˆ–å°ˆé•·..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-logout" onclick="closePostModal()">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-secondary">ç™¼å¸ƒ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ç•™è¨€ Modal -->
        <div id="messageModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ’¬ ç•™è¨€çµ¦ç™¼å¸ƒè€…</h2>
                <div class="info-notice">
                    <strong>âœ… ç•™è¨€å®Œå…¨å…è²»</strong>
                    <p style="margin-top: 10px; color: #0050b3;">ç™¼å¸ƒè€…æŸ¥çœ‹ç•™è¨€æ™‚éœ€æ”¯ä»˜è²»ç”¨ï¼Œæ‚¨å¯ä»¥è‡ªç”±ç•™è¨€ï¼</p>
                </div>
                <form id="messageForm">
                    <div class="form-group">
                        <label>æ‚¨çš„æš±ç¨± (é¸å¡«)</label>
                        <input type="text" id="messageNickname" placeholder="ä¸å¡«å¯«å‰‡é¡¯ç¤ºç‚ºè¨ªå®¢">
                    </div>
                    <div class="form-group">
                        <label>ç•™è¨€å…§å®¹</label>
                        <textarea id="messageContent" required placeholder="è¼¸å…¥æ‚¨çš„ç•™è¨€..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-logout" onclick="closeMessageModal()">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">å…è²»ç™¼é€ç•™è¨€</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- æŸ¥çœ‹ç•™è¨€ Modal -->
        <div id="viewMessagesModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ“¬ æŸ¥çœ‹ç•™è¨€</h2>
                <div id="unlockNotice" class="payment-notice">
                    <strong>ğŸ”’ è§£é–ç•™è¨€éœ€æ”¯ä»˜ NT$ 50</strong>
                    <p style="margin-top: 10px; color: #c53030;">ä¸€æ¬¡æ€§ä»˜è²»å¾Œå¯æŸ¥çœ‹æ­¤è²¼æ–‡çš„æ‰€æœ‰ç•™è¨€</p>
                    <p style="margin-top: 5px; color: #718096;">ç›®å‰é¤˜é¡: NT$ <span id="balanceInViewModal">0</span></p>
                    <button class="btn btn-primary" style="margin-top: 15px;" onclick="unlockMessages()">æ”¯ä»˜ NT$ 50 è§£é–</button>
                </div>
                <div id="messagesContent" style="display: none;"></div>
                <button type="button" class="btn btn-logout" style="width: 100%; margin-top: 20px;" onclick="closeViewMessagesModal()">é—œé–‰</button>
            </div>
        </div>

        <!-- ä¸»ç•«é¢ -->
        <div id="mainScreen">
            <div class="header">
                <h1>ğŸ¯ é›™å‘åª’åˆå¹³å°</h1>
                <div class="user-info">
                    <div id="guestButtons">
                        <button class="btn btn-primary" onclick="showLoginModal()">ç™»å…¥</button>
                        <button class="btn btn-secondary" onclick="showRegisterModal()">è¨»å†Š</button>
                    </div>
                    <div id="loggedInButtons" style="display: none;">
                        <div class="balance" onclick="openRechargeModal()" title="é»æ“Šå„²å€¼">
                            ğŸ’° é¤˜é¡: NT$ <span id="userBalance">0</span>
                        </div>
                        <span id="userName">ä½¿ç”¨è€…</span>
                        <button class="btn btn-logout" onclick="logout()">ç™»å‡º</button>
                    </div>
                </div>
            </div>

            <div id="guestNotice" class="guest-notice" style="display: none;">
                <strong>ğŸ‘‹ æ‚¨ç›®å‰æ˜¯è¨ªå®¢æ¨¡å¼</strong>
                <p>å¯ä»¥ç€è¦½ä¸¦å…è²»ç•™è¨€ï¼Œç™»å…¥å¾Œå¯ç™¼å¸ƒå…§å®¹ä¸¦æŸ¥çœ‹ç•™è¨€</p>
                <button class="btn btn-primary" onclick="showLoginModal()">ç«‹å³ç™»å…¥</button>
                <button class="btn btn-secondary" onclick="showRegisterModal()">å…è²»è¨»å†Š</button>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="section-header">
                        <h2>ğŸ¢ æ‰¾äººæ‰ï¼ˆå·¥ä½œæ©Ÿæœƒï¼‰</h2>
                        <button class="btn btn-warning" onclick="openPostModal('job')">+ ç™¼å¸ƒå·¥ä½œ</button>
                    </div>
                    <input type="text" class="search-input" id="searchJobs" placeholder="ğŸ” æœå°‹å·¥ä½œ...">
                    <div id="jobsList"></div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2>ğŸ‘” æ‰¾å·¥ä½œï¼ˆå°ˆæ¥­äººæ‰ï¼‰</h2>
                        <button class="btn btn-secondary" onclick="openPostModal('talent')">+ æˆ‘è¦æ‰¾å·¥ä½œ</button>
                    </div>
                    <input type="text" class="search-input" id="searchTalents" placeholder="ğŸ” æœå°‹äººæ‰...">
                    <div id="talentsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('users')) || {};
        let posts = JSON.parse(localStorage.getItem('posts')) || [];
        let selectedRechargeAmount = 0;
        let selectedPaymentMethod = '';
        let currentMessagePostId = null;
        let currentViewPostId = null;

        window.onload = function() {
            loadPosts();
            updateUIForUser();
            document.getElementById('searchJobs').addEventListener('input', loadPosts);
            document.getElementById('searchTalents').addEventListener('input', loadPosts);
        };

        function updateUIForUser() {
            const guestButtons = document.getElementById('guestButtons');
            const loggedInButtons = document.getElementById('loggedInButtons');
            const guestNotice = document.getElementById('guestNotice');

            if (currentUser) {
                guestButtons.style.display = 'none';
                loggedInButtons.style.display = 'flex';
                guestNotice.style.display = 'none';
                document.getElementById('userName').textContent = currentUser;
                document.getElementById('userBalance').textContent = users[currentUser].balance;
            } else {
                guestButtons.style.display = 'flex';
                loggedInButtons.style.display = 'none';
                guestNotice.style.display = 'block';
            }
        }

        // === ç™»å…¥/è¨»å†Š ===
        function showLoginModal() {
            switchAuthTab('login');
            document.getElementById('loginModal').classList.add('active');
        }

        function showRegisterModal() {
            switchAuthTab('register');
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabBtns = document.querySelectorAll('#loginModal .tab-btn');
            
            tabBtns.forEach(btn => btn.classList.remove('active'));
            
            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                tabBtns[0].classList.add('active');
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                tabBtns[1].classList.add('active');
            }
        }

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;

            if (password !== passwordConfirm) {
                alert('å¯†ç¢¼ä¸ä¸€è‡´ï¼');
                return;
            }

            if (users[username]) {
                alert('æ­¤å¸³è™Ÿå·²å­˜åœ¨ï¼');
                return;
            }

            users[username] = {
                password: password,
                balance: 500,
                unlockedPosts: []
            };

            localStorage.setItem('users', JSON.stringify(users));
            alert('è¨»å†ŠæˆåŠŸï¼å·²è´ˆé€ NT$ 500');
            switchAuthTab('login');
            this.reset();
        });

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!users[username] || users[username].password !== password) {
                alert('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼');
                return;
            }

            currentUser = username;
            updateUIForUser();
            loadPosts();
            closeLoginModal();
            this.reset();
            alert('ç™»å…¥æˆåŠŸï¼');
        });

        function logout() {
            currentUser = null;
            updateUIForUser();
            loadPosts();
        }

        // === å„²å€¼ç³»çµ± ===
        function openRechargeModal() {
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥ï¼');
                showLoginModal();
                return;
            }
            document.getElementById('rechargeModal').classList.add('active');
        }

        function closeRechargeModal() {
            document.getElementById('rechargeModal').classList.remove('active');
            selectedRechargeAmount = 0;
            selectedPaymentMethod = '';
            document.getElementById('customAmount').value = '';
            document.querySelectorAll('.recharge-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.payment-method').forEach(c => c.classList.remove('selected'));
        }

        function selectRecharge(amount) {
            selectedRechargeAmount = amount;
            document.getElementById('customAmount').value = '';
            document.querySelectorAll('.recharge-card').forEach(c => c.classList.remove('selected'));
            event.target.closest('.recharge-card').classList.add('selected');
        }

        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            document.querySelectorAll('.payment-method').forEach(c => c.classList.remove('selected'));
            event.target.closest('.payment-method').classList.add('selected');
        }

        function confirmRecharge() {
            let amount = selectedRechargeAmount;
            const customAmount = parseInt(document.getElementById('customAmount').value);
            
            if (customAmount > 0) amount = customAmount;
            if (amount < 100) {
                alert('å„²å€¼é‡‘é¡ä¸å¾—ä½æ–¼ NT$ 100');
                return;
            }
            if (!selectedPaymentMethod) {
                alert('è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼');
                return;
            }

            let bonus = 0;
            if (amount >= 5000) bonus = 1000;
            else if (amount >= 2000) bonus = 300;
            else if (amount >= 1000) bonus = 100;

            const total = amount + bonus;
            const methodNames = {
                ecpay: 'ç¶ ç•ŒECPay',
                newebpay: 'è—æ–°NewebPay',
                linepay: 'LINE Pay',
                jkopay: 'è¡—å£æ”¯ä»˜'
            };

            if (confirm(`ç¢ºèªä½¿ç”¨ ${methodNames[selectedPaymentMethod]} å„²å€¼ NT$ ${amount}${bonus > 0 ? ` (é€$${bonus})` : ''} = NT$ ${total}ï¼Ÿ\n\nâ€» æ­¤ç‚ºç¤ºç¯„ç³»çµ±ï¼Œå¯¦éš›é‡‘æµéœ€ä¸²æ¥ç¬¬ä¸‰æ–¹æ”¯ä»˜`)) {
                // æ¨¡æ“¬é‡‘æµè™•ç†
                alert('æ­£åœ¨è·³è½‰è‡³ä»˜æ¬¾é é¢...\n\nâ€» å¯¦éš›ç³»çµ±æœƒè·³è½‰è‡³ ' + methodNames[selectedPaymentMethod]);
                
                setTimeout(() => {
                    users[currentUser].balance += total;
                    localStorage.setItem('users', JSON.stringify(users));
                    updateUIForUser();
                    alert(`ä»˜æ¬¾æˆåŠŸï¼å·²å¢åŠ  NT$ ${total}`);
                    closeRechargeModal();
                }, 1000);
            }
        }

        // === ç™¼å¸ƒç³»çµ± ===
        function openPostModal(type) {
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥æ‰èƒ½ç™¼å¸ƒï¼');
                showLoginModal();
                return;
            }
            document.getElementById('postType').value = type;
            document.getElementById('postModalTitle').textContent = type === 'job' ? 'ğŸ¢ ç™¼å¸ƒå·¥ä½œæ©Ÿæœƒ' : 'ğŸ‘” ç™¼å¸ƒå°ˆæ¥­äººæ‰';
            document.getElementById('postModal').classList.add('active');
        }

        function closePostModal() {
            document.getElementById('postModal').classList.remove('active');
            document.getElementById('postForm').reset();
        }

        document.getElementById('postForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const newPost = {
                id: Date.now(),
                type: document.getElementById('postType').value,
                category: document.getElementById('postCategory').value,
                title: document.getElementById('postTitle').value.trim(),
                content: document.getElementById('postContent').value.trim(),
                author: currentUser,
                time: new Date().toLocaleString('zh-TW'),
                messages: []
            };

            posts.unshift(newPost);
            localStorage.setItem('posts', JSON.stringify(posts));
            loadPosts();
            closePostModal();
            alert('ç™¼å¸ƒæˆåŠŸï¼');
        });

        // === ç•™è¨€ç³»çµ± ===
        function openMessageModal(postId) {
            currentMessagePostId = postId;
            document.getElementById('messageModal').classList.add('active');
        }

        function closeMessageModal() {
            document.getElementById('messageModal').classList.remove('active');
            document.getElementById('messageForm').reset();
            currentMessagePostId = null;
        }

        document.getElementById('messageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const nickname = document.getElementById('messageNickname').value.trim() || 'è¨ªå®¢';
            const content = document.getElementById('messageContent').value.trim();

            const post = posts.find(p => p.id === currentMessagePostId);
            if (post) {
                post.messages.push({
                    nickname: nickname,
                    content: content,
                    time: new Date().toLocaleString('zh-TW')
                });
                localStorage.setItem('posts', JSON.stringify(posts));
                loadPosts();
            }

            closeMessageModal();
            alert('ç•™è¨€ç™¼é€æˆåŠŸï¼');
        });

        // === æŸ¥çœ‹ç•™è¨€ç³»çµ± ===
        function openViewMessagesModal(postId) {
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥æ‰èƒ½æŸ¥çœ‹ç•™è¨€ï¼');
                showLoginModal();
                return;
            }

            currentViewPostId = postId;
            const post = posts.find(p => p.id === postId);
            const isUnlocked = users[currentUser].unlockedPosts.includes(postId);

            document.getElementById('balanceInViewModal').textContent = users[currentUser].balance;

            if (isUnlocked) {
                showUnlockedMessages(post);
            } else {
                document.getElementById('unlockNotice').style.display = 'block';
                document.getElementById('messagesContent').style.display = 'none';
            }

            document.getElementById('viewMessagesModal').classList.add('active');
        }

        function closeViewMessagesModal() {
            document.getElementById('viewMessagesModal').classList.remove('active');
            currentViewPostId = null;
        }

        function unlockMessages() {
            if (users[currentUser].balance < 50) {
                alert('é¤˜é¡ä¸è¶³ï¼éœ€è¦ NT$ 50\nè«‹é»æ“Šå³ä¸Šè§’å„²å€¼');
                return;
            }

            if (confirm('ç¢ºèªæ”¯ä»˜ NT$ 50 è§£é–æ­¤è²¼æ–‡çš„æ‰€æœ‰ç•™è¨€ï¼Ÿ')) {
                users[currentUser].balance -= 50;
                users[currentUser].unlockedPosts.push(currentViewPostId);
                localStorage.setItem('users', JSON.stringify(users));
                updateUIForUser();

                const post = posts.find(p => p.id === currentViewPostId);
                showUnlockedMessages(post);
                alert('è§£é–æˆåŠŸï¼å·²æ‰£é™¤ NT$ 50');
            }
        }

        function showUnlockedMessages(post) {
            document.getElementById('unlockNotice').style.display = 'none';
            const content = document.getElementById('messagesContent');
            content.style.display = 'block';

            if (post.messages.length === 0) {
                content.innerHTML = '<div style="text-align: center; padding: 30px; color: #a0aec0;">ç›®å‰æ²’æœ‰ç•™è¨€</div>';
            } else {
                content.innerHTML = '<h3 style="margin-bottom: 15px;">ğŸ’¬ æ‰€æœ‰ç•™è¨€</h3>' + 
                    post.messages.map(m => `
                        <div class="reply-item">
                            <div class="reply-author">${m.nickname}</div>
                            <div style="color: #4a5568; line-height: 1.5;">${m.content}</div>
                            <div style="color: #a0aec0; font-size: 12px; margin-top: 5px;">${m.time}</div>
                        </div>
                    `).join('');
            }
        }

        // === è¼‰å…¥è²¼æ–‡ ===
        function loadPosts() {
            const jobSearch = document.getElementById('searchJobs').value.toLowerCase();
            const talentSearch = document.getElementById('searchTalents').value.toLowerCase();

            let jobPosts = posts.filter(p => p.type === 'job');
            let talentPosts = posts.filter(p => p.type === 'talent');

            if (jobSearch) {
                jobPosts = jobPosts.filter(p => 
                    p.title.toLowerCase().includes(jobSearch) || 
                    p.content.toLowerCase().includes(jobSearch) ||
                    p.category.toLowerCase().includes(jobSearch)
                );
            }

            if (talentSearch) {
                talentPosts = talentPosts.filter(p => 
                    p.title.toLowerCase().includes(talentSearch) || 
                    p.content.toLowerCase().includes(talentSearch) ||
                    p.category.toLowerCase().includes(talentSearch)
                );
            }

            renderPosts('jobsList', jobPosts, 'job');
            renderPosts('talentsList', talentPosts, 'talent');
        }

        function renderPosts(elementId, postList, type) {
            const element = document.getElementById(elementId);
            
            if (postList.length === 0) {
                element.innerHTML = `<div style="text-align: center; padding: 40px; color: #a0aec0;">ç›®å‰æ²’æœ‰${type === 'job' ? 'å·¥ä½œæ©Ÿæœƒ' : 'äººæ‰'}</div>`;
                return;
            }

            element.innerHTML = postList.map(post => {
                const isAuthor = currentUser && post.author === currentUser;
                const isUnlocked = currentUser && users[currentUser].unlockedPosts.includes(post.id);
                const messageCount = post.messages.length;

                return `
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">${post.title}</div>
                                <div class="card-author">ğŸ‘¤ ${post.author}</div>
                                <span class="card-category">${post.category}</span>
                            </div>
                            <span class="card-badge badge-${post.type}">${post.type === 'job' ? 'å¾µæ‰' : 'æ±‚è·'}</span>
                        </div>
                        <div class="card-content">${post.content}</div>
                        <div class="card-footer">
                            <div style="color: #a0aec0; font-size: 13px;">ğŸ• ${post.time}</div>
                            <div style="color: #667eea; font-weight: bold;">ğŸ’¬ ${messageCount} å‰‡ç•™è¨€</div>
                            ${!isAuthor ? 
                                `<button class="btn btn-primary" onclick="openMessageModal(${post.id})">å…è²»ç•™è¨€</button>` : 
                                `<button class="btn btn-warning" onclick="openViewMessagesModal(${post.id})">${isUnlocked ? 'æŸ¥çœ‹ç•™è¨€' : 'è§£é–ç•™è¨€ ($50)'}</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>
