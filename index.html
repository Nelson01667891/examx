<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™å‘åª’åˆå¹³å° - äººæ‰èˆ‡å·¥ä½œé…å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .balance {
            background: #f0f4ff;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .balance:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #48bb78;
            color: white;
        }

        .btn-secondary:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-logout {
            background: #e2e8f0;
            color: #2d3748;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #2d3748;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #4a5568;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .form-actions button {
            flex: 1;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #e2e8f0;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            color: #718096;
            transition: all 0.3s;
            text-align: center;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .tab-btn:hover {
            border-color: #667eea;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-header h2 {
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 16px;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }

        .card-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-job {
            background: #bee3f8;
            color: #2c5282;
        }

        .badge-talent {
            background: #c6f6d5;
            color: #22543d;
        }

        .card-author {
            color: #718096;
            font-size: 14px;
            margin-top: 5px;
        }

        .card-category {
            display: inline-block;
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 13px;
            margin-top: 10px;
        }

        .card-content {
            color: #4a5568;
            line-height: 1.6;
            margin: 15px 0;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .card-time {
            color: #a0aec0;
            font-size: 13px;
        }

        .replies-count {
            color: #667eea;
            font-weight: bold;
        }

        .replies-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e2e8f0;
        }

        .reply-item {
            background: white;
            padding: 15px;
            border-left: 3px solid #667eea;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .reply-author {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .reply-content {
            color: #4a5568;
            line-height: 1.5;
        }

        .reply-time {
            color: #a0aec0;
            font-size: 12px;
            margin-top: 5px;
        }

        .no-items {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
        }

        .guest-notice {
            background: #fef5e7;
            border: 2px solid #f39c12;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            color: #d68910;
        }

        .payment-notice {
            background: #fff5f5;
            border: 2px solid #fc8181;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }

        .payment-notice strong {
            color: #c53030;
            font-size: 18px;
        }

        .recharge-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .recharge-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .recharge-card:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.05);
        }

        .recharge-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .recharge-amount {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .recharge-label {
            color: #718096;
            font-size: 14px;
        }

        .recharge-bonus {
            background: #48bb78;
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 12px;
            margin-top: 8px;
            display: inline-block;
        }

        .transaction-history {
            margin-top: 20px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .transaction-type {
            font-weight: bold;
        }

        .transaction-type.income {
            color: #48bb78;
        }

        .transaction-type.expense {
            color: #f56565;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .user-info {
                width: 100%;
                justify-content: space-between;
            }

            .recharge-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™»å…¥/è¨»å†Š Modal -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ¯ é›™å‘åª’åˆå¹³å°</h2>
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchAuthTab('login')">ç™»å…¥</button>
                    <button class="tab-btn" onclick="switchAuthTab('register')">è¨»å†Š</button>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label>å¸³è™Ÿ</label>
                        <input type="text" id="loginUsername" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç¢¼</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å…¥</button>
                    <button type="button" class="btn btn-logout" style="width: 100%; margin-top: 10px;" onclick="closeLoginModal()">å–æ¶ˆ</button>
                </form>

                <form id="registerForm" style="display: none;">
                    <div class="form-group">
                        <label>å¸³è™Ÿ</label>
                        <input type="text" id="registerUsername" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç¢¼</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <div class="form-group">
                        <label>ç¢ºèªå¯†ç¢¼</label>
                        <input type="password" id="registerPasswordConfirm" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">è¨»å†Š (é€ NT$ 500)</button>
                    <button type="button" class="btn btn-logout" style="width: 100%; margin-top: 10px;" onclick="closeLoginModal()">å–æ¶ˆ</button>
                </form>
            </div>
        </div>

        <!-- å„²å€¼ Modal -->
        <div id="rechargeModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ’° å„²å€¼ä¸­å¿ƒ</h2>
                <p style="color: #718096; margin-bottom: 20px;">é¸æ“‡å„²å€¼é‡‘é¡ï¼Œäº«å—æ›´å¤šæœå‹™</p>
                
                <div class="recharge-options">
                    <div class="recharge-card" onclick="selectRecharge(500)">
                        <div class="recharge-amount">$500</div>
                        <div class="recharge-label">åŸºç¤æ–¹æ¡ˆ</div>
                    </div>
                    <div class="recharge-card" onclick="selectRecharge(1000)">
                        <div class="recharge-amount">$1000</div>
                        <div class="recharge-label">ç†±é–€æ–¹æ¡ˆ</div>
                        <div class="recharge-bonus">é€ $100</div>
                    </div>
                    <div class="recharge-card" onclick="selectRecharge(2000)">
                        <div class="recharge-amount">$2000</div>
                        <div class="recharge-label">è¶…å€¼æ–¹æ¡ˆ</div>
                        <div class="recharge-bonus">é€ $300</div>
                    </div>
                    <div class="recharge-card" onclick="selectRecharge(5000)">
                        <div class="recharge-amount">$5000</div>
                        <div class="recharge-label">å°Šæ¦®æ–¹æ¡ˆ</div>
                        <div class="recharge-bonus">é€ $1000</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>è‡ªè¨‚é‡‘é¡</label>
                    <input type="number" id="customAmount" placeholder="è¼¸å…¥è‡ªè¨‚é‡‘é¡" min="100">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-logout" onclick="closeRechargeModal()">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-secondary" onclick="confirmRecharge()">ç¢ºèªå„²å€¼</button>
                </div>

                <div class="transaction-history">
                    <h3 style="margin-bottom: 15px; color: #2d3748;">äº¤æ˜“è¨˜éŒ„</h3>
                    <div id="transactionList"></div>
                </div>
            </div>
        </div>

        <!-- ç™¼å¸ƒ Modal -->
        <div id="postModal" class="modal">
            <div class="modal-content">
                <h2 id="postModalTitle">ç™¼å¸ƒå…§å®¹</h2>
                <form id="postForm">
                    <div class="form-group">
                        <label>é¡å‹</label>
                        <select id="postType" required>
                            <option value="job">ğŸ¢ æˆ‘è¦æ‰¾äººæ‰ï¼ˆç™¼å¸ƒå·¥ä½œï¼‰</option>
                            <option value="talent">ğŸ‘” æˆ‘è¦æ‰¾å·¥ä½œï¼ˆå°ˆæ¥­äººæ‰ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>é ˜åŸŸåˆ†é¡</label>
                        <select id="postCategory" required>
                            <option value="">è«‹é¸æ“‡é ˜åŸŸ</option>
                            <option value="ç¨‹å¼é–‹ç™¼">ğŸ’» ç¨‹å¼é–‹ç™¼</option>
                            <option value="è¨­è¨ˆç¾è¡“">ğŸ¨ è¨­è¨ˆç¾è¡“</option>
                            <option value="è¡ŒéŠ·ä¼åŠƒ">ğŸ“Š è¡ŒéŠ·ä¼åŠƒ</option>
                            <option value="æ–‡å­—ç·¨è¼¯">âœï¸ æ–‡å­—ç·¨è¼¯</option>
                            <option value="å½±éŸ³è£½ä½œ">ğŸ¬ å½±éŸ³è£½ä½œ</option>
                            <option value="ç¿»è­¯èªè¨€">ğŸŒ ç¿»è­¯èªè¨€</option>
                            <option value="é¡§å•è«®è©¢">ğŸ’¼ é¡§å•è«®è©¢</option>
                            <option value="å…¶ä»–">ğŸ“Œ å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ¨™é¡Œ</label>
                        <input type="text" id="postTitle" required placeholder="ä¾‹ï¼šå°‹æ‰¾è³‡æ·±å‰ç«¯å·¥ç¨‹å¸« æˆ– 5å¹´ç¶“é©—å¹³é¢è¨­è¨ˆå¸«æ‰¾æ¡ˆ">
                    </div>
                    <div class="form-group">
                        <label>è©³ç´°å…§å®¹</label>
                        <textarea id="postContent" required placeholder="è©³ç´°æè¿°æ‚¨çš„éœ€æ±‚æˆ–å°ˆé•·..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-logout" onclick="closePostModal()">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-secondary">ç™¼å¸ƒ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- å›è¦† Modal -->
        <div id="replyModal" class="modal">
            <div class="modal-content">
                <h2>å›è¦†å…§å®¹</h2>
                <div class="payment-notice">
                    <strong>âš ï¸ å›è¦†éœ€æ”¯ä»˜ NT$ 100</strong>
                    <p style="margin-top: 10px; color: #718096;">æ­¤è²»ç”¨å°‡å¾æ‚¨çš„å¸³æˆ¶é¤˜é¡æ‰£é™¤</p>
                    <p style="margin-top: 5px; color: #718096;">ç›®å‰é¤˜é¡: NT$ <span id="currentBalanceInModal">0</span></p>
                </div>
                <form id="replyForm">
                    <div class="form-group">
                        <label>æ‚¨çš„å›è¦†</label>
                        <textarea id="replyContent" required placeholder="è¼¸å…¥æ‚¨çš„å›è¦†å…§å®¹..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-logout" onclick="closeReplyModal()">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">æ”¯ä»˜ NT$ 100 ä¸¦å›è¦†</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ä¸»ç•«é¢ -->
        <div id="mainScreen">
            <div class="header">
                <h1>ğŸ¯ é›™å‘åª’åˆå¹³å°</h1>
                <div class="user-info" id="userInfoSection">
                    <!-- è¨ªå®¢æ¨¡å¼ -->
                    <div id="guestButtons">
                        <button class="btn btn-primary" onclick="showLoginModal()">ç™»å…¥</button>
                        <button class="btn btn-secondary" onclick="showRegisterModal()">è¨»å†Š</button>
                    </div>
                    <!-- ç™»å…¥æ¨¡å¼ -->
                    <div id="loggedInButtons" style="display: none;">
                        <div class="balance" onclick="openRechargeModal()" title="é»æ“Šå„²å€¼">
                            ğŸ’° é¤˜é¡: NT$ <span id="userBalance">0</span>
                        </div>
                        <span id="userName">ä½¿ç”¨è€…</span>
                        <button class="btn btn-logout" onclick="logout()">ç™»å‡º</button>
                    </div>
                </div>
            </div>

            <!-- è¨ªå®¢æç¤º -->
            <div id="guestNotice" class="guest-notice" style="display: none;">
                <strong>ğŸ‘‹ æ‚¨ç›®å‰æ˜¯è¨ªå®¢æ¨¡å¼</strong>
                <p>å¯ä»¥ç€è¦½æ‰€æœ‰å…§å®¹ï¼Œä½†éœ€è¦ç™»å…¥æ‰èƒ½ç™¼å¸ƒå’Œå›è¦†</p>
                <button class="btn btn-primary" onclick="showLoginModal()">ç«‹å³ç™»å…¥</button>
                <button class="btn btn-secondary" onclick="showRegisterModal()">å…è²»è¨»å†Š</button>
            </div>

            <div class="main-content">
                <!-- æ‰¾äººæ‰å€ï¼ˆé›‡ä¸»ç™¼å¸ƒå·¥ä½œï¼‰ -->
                <div class="section">
                    <div class="section-header">
                        <h2>ğŸ¢ æ‰¾äººæ‰ï¼ˆå·¥ä½œæ©Ÿæœƒï¼‰</h2>
                        <button class="btn btn-warning" onclick="openPostModal('job')">+ ç™¼å¸ƒå·¥ä½œ</button>
                    </div>
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchJobs" placeholder="ğŸ” æœå°‹å·¥ä½œå…§å®¹æˆ–é ˜åŸŸ...">
                    </div>
                    <div id="jobsList"></div>
                </div>

                <!-- æ‰¾å·¥ä½œå€ï¼ˆäººæ‰ç™¼å¸ƒå°ˆé•·ï¼‰ -->
                <div class="section">
                    <div class="section-header">
                        <h2>ğŸ‘” æ‰¾å·¥ä½œï¼ˆå°ˆæ¥­äººæ‰ï¼‰</h2>
                        <button class="btn btn-secondary" onclick="openPostModal('talent')">+ æˆ‘è¦æ‰¾å·¥ä½œ</button>
                    </div>
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchTalents" placeholder="ğŸ” æœå°‹äººæ‰å°ˆé•·æˆ–é ˜åŸŸ...">
                    </div>
                    <div id="talentsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™å„²å­˜
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('users')) || {};
        let posts = JSON.parse(localStorage.getItem('posts')) || [];
        let currentReplyPostId = null;
        let selectedRechargeAmount = 0;

        // åˆå§‹åŒ–
        window.onload = function() {
            loadPosts();
            updateUIForUser();
            
            // æœå°‹åŠŸèƒ½
            document.getElementById('searchJobs').addEventListener('input', function() {
                loadPosts();
            });
            
            document.getElementById('searchTalents').addEventListener('input', function() {
                loadPosts();
            });
        };

        // æ›´æ–°UIé¡¯ç¤º
        function updateUIForUser() {
            const guestButtons = document.getElementById('guestButtons');
            const loggedInButtons = document.getElementById('loggedInButtons');
            const guestNotice = document.getElementById('guestNotice');

            if (currentUser) {
                guestButtons.style.display = 'none';
                loggedInButtons.style.display = 'flex';
                guestNotice.style.display = 'none';
                document.getElementById('userName').textContent = currentUser;
                document.getElementById('userBalance').textContent = users[currentUser].balance;
            } else {
                guestButtons.style.display = 'flex';
                loggedInButtons.style.display = 'none';
                guestNotice.style.display = 'block';
            }
        }

        // === ç™»å…¥/è¨»å†Šç³»çµ± ===
        function showLoginModal() {
            switchAuthTab('login');
            document.getElementById('loginModal').classList.add('active');
        }

        function showRegisterModal() {
            switchAuthTab('register');
            document.getElementById('loginModal').classList.add('active');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabBtns = document.querySelectorAll('#loginModal .tab-btn');
            
            tabBtns.forEach(btn => btn.classList.remove('active'));
            
            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                tabBtns[0].classList.add('active');
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                tabBtns[1].classList.add('active');
            }
        }

        // è¨»å†Š
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;

            if (password !== passwordConfirm) {
                alert('å¯†ç¢¼ä¸ä¸€è‡´ï¼');
                return;
            }

            if (users[username]) {
                alert('æ­¤å¸³è™Ÿå·²å­˜åœ¨ï¼');
                return;
            }

            users[username] = {
                password: password,
                balance: 500,
                transactions: [{
                    type: 'income',
                    amount: 500,
                    description: 'è¨»å†Šè´ˆé€',
                    time: new Date().toLocaleString('zh-TW')
                }]
            };

            localStorage.setItem('users', JSON.stringify(users));
            alert('è¨»å†ŠæˆåŠŸï¼å·²è´ˆé€ NT$ 500ï¼Œè«‹ç™»å…¥');
            switchAuthTab('login');
            this.reset();
        });

        // ç™»å…¥
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!users[username]) {
                alert('å¸³è™Ÿä¸å­˜åœ¨ï¼');
                return;
            }

            if (users[username].password !== password) {
                alert('å¯†ç¢¼éŒ¯èª¤ï¼');
                return;
            }

            currentUser = username;
            updateUIForUser();
            loadPosts();
            closeLoginModal();
            this.reset();
            alert('ç™»å…¥æˆåŠŸï¼');
        });

        // ç™»å‡º
        function logout() {
            currentUser = null;
            updateUIForUser();
            loadPosts();
        }

        // === å„²å€¼ç³»çµ± ===
        function openRechargeModal() {
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥ï¼');
                showLoginModal();
                return;
            }
            loadTransactions();
            document.getElementById('rechargeModal').classList.add('active');
        }

        function closeRechargeModal() {
            document.getElementById('rechargeModal').classList.remove('active');
            document.getElementById('customAmount').value = '';
            selectedRechargeAmount = 0;
            document.querySelectorAll('.recharge-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        function selectRecharge(amount) {
            selectedRechargeAmount = amount;
            document.getElementById('customAmount').value = '';
            document.querySelectorAll('.recharge-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.recharge-card').classList.add('selected');
        }

        function confirmRecharge() {
            let amount = selectedRechargeAmount;
            const customAmount = parseInt(document.getElementById('customAmount').value);
            
            if (customAmount > 0) {
                amount = customAmount;
            }

            if (amount < 100) {
                alert('å„²å€¼é‡‘é¡ä¸å¾—ä½æ–¼ NT$ 100');
                return;
            }

            // è¨ˆç®—è´ˆé€é‡‘é¡
            let bonus = 0;
            if (amount >= 5000) bonus = 1000;
            else if (amount >= 2000) bonus = 300;
            else if (amount >= 1000) bonus = 100;

            const total = amount + bonus;

            if (confirm(`ç¢ºèªå„²å€¼ NT$ ${amount}${bonus > 0 ? ` + è´ˆé€ NT$ ${bonus}` : ''} = NT$ ${total}ï¼Ÿ`)) {
                users[currentUser].balance += total;
                
                if (!users[currentUser].transactions) {
                    users[currentUser].transactions = [];
                }
                
                users[currentUser].transactions.unshift({
                    type: 'income',
                    amount: total,
                    description: `å„²å€¼ $${amount}${bonus > 0 ? ` (å«è´ˆé€ $${bonus})` : ''}`,
                    time: new Date().toLocaleString('zh-TW')
                });

                localStorage.setItem('users', JSON.stringify(users));
                updateUIForUser();
                loadTransactions();
                alert(`å„²å€¼æˆåŠŸï¼å·²å¢åŠ  NT$ ${total}`);
            }
        }

        function loadTransactions() {
            const list = document.getElementById('transactionList');
            const transactions = users[currentUser].transactions || [];
            
            if (transactions.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #a0aec0; padding: 20px;">æš«ç„¡äº¤æ˜“è¨˜éŒ„</div>';
                return;
            }

            list.innerHTML = transactions.slice(0, 10).map(t => `
                <div class="transaction-item">
                    <div>
                        <div class="transaction-type ${t.type}">${t.description}</div>
                        <div style="font-size: 12px; color: #a0aec0;">${t.time}</div>
                    </div>
                    <div class="transaction-type ${t.type}">
                        ${t.type === 'income' ? '+' : '-'} NT$ ${t.amount}
                    </div>
                </div>
            `).join('');
        }

        // === ç™¼å¸ƒç³»çµ± ===
        function openPostModal(type) {
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥æ‰èƒ½ç™¼å¸ƒï¼');
                showLoginModal();
                return;
            }
            
            document.getElementById('postType').value = type;
            document.getElementById('postModalTitle').textContent = type === 'job' ? 'ğŸ¢ ç™¼å¸ƒå·¥ä½œæ©Ÿæœƒ' : 'ğŸ‘” ç™¼å¸ƒå°ˆæ¥­äººæ‰';
            document.getElementById('postModal').classList.add('active');
        }

        function closePostModal() {
            document.getElementById('postModal').classList.remove('active');
            document.getElementById('postForm').reset();
        }

        document.getElementById('postForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const type = document.getElementById('postType').value;
            const category = document.getElementById('postCategory').value;
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();

            const newPost = {
                id: Date.now(),
                type: type,
                category: category,
                title: title,
                content: content,
                author: currentUser,
                time: new Date().toLocaleString('zh-TW'),
                replies: []
            };

            posts.unshift(newPost);
            localStorage.setItem('posts', JSON.stringify(posts));
            loadPosts();
            closePostModal();
            alert('ç™¼å¸ƒæˆåŠŸï¼');
        });

        // === å›è¦†ç³»çµ± ===
        function openReplyModal(postId) {
            if (!currentUser) {
                alert('è«‹å…ˆç™»å…¥æ‰èƒ½å›è¦†ï¼');
                showLoginModal();
                return;
            }

            if (users[currentUser].balance < 100) {
                alert('é¤˜é¡ä¸è¶³ï¼å›è¦†éœ€è¦ NT$ 100\n\nè«‹é»æ“Šå³ä¸Šè§’é¤˜é¡é€²è¡Œå„²å€¼');
                return;
            }

            currentReplyPostId = postId;
            document.getElementById('currentBalanceInModal').textContent = users[currentUser].balance;
            document.getElementById('replyModal').classList.add('active');
        }

        function closeReplyModal() {
            document.getElementById('replyModal').classList.remove('active');
            document.getElementById('replyForm').reset();
            currentReplyPostId = null;
        }

        document.getElementById('replyForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const content = document.getElementById('replyContent').value.trim();

            // æ‰£æ¬¾
            users[currentUser].balance -= 100;
            
            if (!users[currentUser].transactions) {
                users[currentUser].transactions = [];
            }
            
            users[currentUser].transactions.unshift({
                type: 'expense',
                amount: 100,
                description: 'å›è¦†è¨Šæ¯',
                time: new Date().toLocaleString('zh-TW')
            });

            localStorage.setItem('users', JSON.stringify(users));
            updateUIForUser();

            // æ–°å¢å›è¦†
            const post = posts.find(p => p.id === currentReplyPostId);
            if (post) {
                post.replies.push({
                    author: currentUser,
                    content: content,
                    time: new Date().toLocaleString('zh-TW')
                });
                localStorage.setItem('posts', JSON.stringify(posts));
                loadPosts();
            }

            closeReplyModal();
            alert('å›è¦†æˆåŠŸï¼å·²æ‰£é™¤ NT$ 100');
        });

        // === è¼‰å…¥è²¼æ–‡ ===
        function loadPosts() {
            const jobSearch = document.getElementById('searchJobs').value.toLowerCase().trim();
            const talentSearch = document.getElementById('searchTalents').value.toLowerCase().trim();
            
            const jobPosts = posts.filter(p => p.type === 'job');
            const talentPosts = posts.filter(p => p.type === 'talent');

            // éæ¿¾å·¥ä½œ
            let filteredJobs = jobPosts;
            if (jobSearch) {
                filteredJobs = jobPosts.filter(p => 
                    p.title.toLowerCase().includes(jobSearch) || 
                    p.content.toLowerCase().includes(jobSearch) ||
                    p.category.toLowerCase().includes(jobSearch)
                );
            }

            // éæ¿¾äººæ‰
            let filteredTalents = talentPosts;
            if (talentSearch) {
                filteredTalents = talentPosts.filter(p => 
                    p.title.toLowerCase().includes(talentSearch) || 
                    p.content.toLowerCase().includes(talentSearch) ||
                    p.category.toLowerCase().includes(talentSearch)
                );
            }

            renderPosts('jobsList', filteredJobs, 'job');
            renderPosts('talentsList', filteredTalents, 'talent');
        }

        function renderPosts(elementId, postList, type) {
            const element = document.getElementById(elementId);
            
            if (postList.length === 0) {
                element.innerHTML = `<div class="no-items">ç›®å‰æ²’æœ‰${type === 'job' ? 'å·¥ä½œæ©Ÿæœƒ' : 'äººæ‰'}ï¼Œå¿«ä¾†ç™¼å¸ƒç¬¬ä¸€å€‹å§ï¼</div>`;
                return;
            }

            element.innerHTML = postList.map(post => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">${post.title}</div>
                            <div class="card-author">ğŸ‘¤ ${post.author}</div>
                            <span class="card-category">${post.category}</span>
                        </div>
                        <span class="card-badge badge-${post.type}">${post.type === 'job' ? 'å¾µæ‰' : 'æ±‚è·'}</span>
                    </div>
                    <div class="card-content">${post.content}</div>
                    <div class="card-footer">
                        <div class="card-time">ğŸ• ${post.time}</div>
                        <div class="replies-count">ğŸ’¬ ${post.replies.length} å‰‡å›è¦†</div>
                        ${post.author !== currentUser ? 
                            `<button class="btn btn-primary" onclick="openReplyModal(${post.id})">ğŸ’° NT$ 100 å›è¦†</button>` : 
                            ''}
                    </div>
                    ${post.replies.length > 0 ? `
                        <div class="replies-section">
                            <strong>å›è¦†å…§å®¹ï¼š</strong>
                            ${post.replies.map(reply => `
                                <div class="reply-item">
                                    <div class="reply-author">${reply.author}</div>
                                    <div class="reply-content">${reply.content}</div>
                                    <div class="reply-time">${reply.time}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
    </script>
</body>
</html>
